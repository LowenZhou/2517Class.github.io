<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高中语文课堂阎王点卯系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            transition: all 0.3s;
        }
        
        .title-input {
            width: 100%;
            padding: 10px;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .roll-section, .ranking-section {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .file-upload {
            margin-bottom: 20px;
        }
        
        .file-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .roll-display {
            height: 200px;
            border: 2px dashed #3498db;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .roll-names {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            width: 100%;
            height: 100%;
            padding: 10px;
        }
        
        .name-item {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-label {
            font-weight: bold;
        }
        
        .speed-slider, .count-slider {
            width: 100%;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            flex: 1;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .stop-btn {
            background-color: #e74c3c;
        }
        
        .stop-btn:hover {
            background-color: #c0392b;
        }
        
        .ranking-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #ecf0f1;
            transition: transform 0.2s;
        }
        
        .ranking-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .rank-1, .rank-2, .rank-3 {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .rank-1 {
            background-color: #ffd700;
            color: #333;
        }
        
        .rank-2 {
            background-color: #c0c0c0;
            color: #333;
        }
        
        .rank-3 {
            background-color: #cd7f32;
            color: #333;
        }
        
        .rank-title {
            font-size: 0.9rem;
            margin-left: 5px;
            font-style: italic;
        }
        
        .student-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .student-score {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .score-controls {
            display: flex;
            gap: 5px;
        }
        
        .score-btn {
            padding: 5px 10px;
            font-size: 0.9rem;
            flex: 0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .roll-display {
                height: 150px;
            }
            
            .name-item {
                font-size: 1.2rem;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <a href="https://lowenzhou.github.io/2517/2517.html">2517</a>
    <div class="container">
        <div class="header">
            <input type="text" class="title-input" value="请输入文本" placeholder="请输入课堂标题">
            <h1 class="title">高中语文生死局</h1>
        </div>
        
        <div class="main-content">
            <div class="roll-section">
                <h2 class="section-title">随机点卯</h2>
                
                <div class="file-upload">
                    <label class="file-label">上传生死状 (Excel文件):</label>
                    <input type="file" id="file-input" accept=".xlsx, .xls">
                </div>
                
                <div class="roll-display">
                    <div class="roll-names" id="roll-names">
                        <div class="name-item">请上传学生生死名单</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label class="control-label">滚动速度:</label>
                        <input type="range" min="1" max="10" value="5" class="speed-slider" id="speed-slider">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">一次处决人数:</label>
                        <input type="range" min="1" max="50" value="3" class="count-slider" id="count-slider">
                        <span id="count-display">3人</span>
                    </div>
                    
                    <div class="buttons">
                        <button id="start-btn">开始点名</button>
                        <button id="stop-btn" class="stop-btn" disabled>抽选</button>
                    </div>
                </div>
            </div>
            
            <div class="ranking-section">
                <h2 class="section-title">生死榜</h2>
                <ul class="ranking-list" id="ranking-list">
                    <!-- 排行榜将通过JavaScript动态生成 -->
                </ul>
            </div>
        </div>
    </div>

    <!-- 引入SheetJS库用于解析Excel文件 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // 全局变量
        let students = [];
        let isRolling = false;
        let rollInterval;
        let rollSpeed = 2; // 初始速度(ms)
        let displayCount = 3; // 初始显示人数
        
        // DOM元素
        const titleInput = document.querySelector('.title-input');
        const titleDisplay = document.querySelector('.title');
        const fileInput = document.getElementById('file-input');
        const rollNames = document.getElementById('roll-names');
        const speedSlider = document.getElementById('speed-slider');
        const countSlider = document.getElementById('count-slider');
        const countDisplay = document.getElementById('count-display');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const rankingList = document.getElementById('ranking-list');
        
        // 标题更新
        titleInput.addEventListener('input', function() {
            titleDisplay.textContent = this.value || '高中语文生死局';
        });
        
        // 文件上传处理
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                
                // 获取第一个工作表
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // 处理学生数据
                students = jsonData.map((row, index) => {
                    return {
                        id: index,
                        name: row['姓名'] || '',
                        class: row['班级'] || '',
                        score: Math.floor(91) // 初始随机分数
                    };
                });
                
                // 更新排行榜
                updateRanking();
                
                // 更新显示
                rollNames.innerHTML = '<div class="name-item">准备就绪</div>';
            };
            reader.readAsArrayBuffer(file);
        });
        
        // 速度滑块控制
        speedSlider.addEventListener('input', function() {
            rollSpeed = 30 - (this.value * 25); // 值越大速度越快
            if (isRolling) {
                clearInterval(rollInterval);
                startRolling();
            }
        });
        
        // 人数滑块控制
        countSlider.addEventListener('input', function() {
            displayCount = parseInt(this.value);
            countDisplay.textContent = `${displayCount}人`;
            if (isRolling) {
                clearInterval(rollInterval);
                startRolling();
            }
        });
        
        // 开始点名
        startBtn.addEventListener('click', function() {
            if (students.length === 0) {
                alert('请先上传学生生死名单！');
                return;
            }
            
            isRolling = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            startRolling();
        });
        
        // 停止点名
        stopBtn.addEventListener('click', function() {
            isRolling = false;
            clearInterval(rollInterval);
            startBtn.disabled = false;
            stopBtn.disabled = true;
        });
        
        // 开始滚动显示
        function startRolling() {
            rollInterval = setInterval(() => {
                // 随机选择学生
                const selectedStudents = [];
                const shuffled = [...students].sort(() => 0.5 - Math.random());
                
                for (let i = 0; i < displayCount && i < shuffled.length; i++) {
                    selectedStudents.push(shuffled[i]);
                }
                
                // 更新显示
                rollNames.innerHTML = '';
                selectedStudents.forEach(student => {
                    const nameElement = document.createElement('div');
                    nameElement.className = 'name-item';
                    nameElement.textContent = student.name;
                    rollNames.appendChild(nameElement);
                });
            }, rollSpeed);
        }
        
        // 更新排行榜
        function updateRanking() {
            // 按分数排序
            const sortedStudents = [...students].sort((a, b) => b.score - a.score);
            
            // 清空排行榜
            rankingList.innerHTML = '';
            
            // 添加学生到排行榜
            sortedStudents.forEach((student, index) => {
                const rankItem = document.createElement('li');
                rankItem.className = `ranking-item ${index < 3 ? `rank-${index+1}` : ''}`;
                
                const studentInfo = document.createElement('div');
                studentInfo.className = 'student-info';
                
                const rank = index + 1;
                let rankTitle = '';
                
                if (rank === 1) rankTitle = '王者';
                else if (rank === 2) rankTitle = '宗师';
                else if (rank === 3) rankTitle = '大师';
                
                studentInfo.innerHTML = `
                    <span>${rank}. ${student.name}</span>
                    ${rankTitle ? `<span class="rank-title">${rankTitle}</span>` : ''}
                `;
                
                const scoreControls = document.createElement('div');
                scoreControls.className = 'score-controls';
                
                const scoreDisplay = document.createElement('span');
                scoreDisplay.className = 'student-score';
                scoreDisplay.textContent = student.score;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'score-btn';
                addBtn.textContent = '+';
                addBtn.addEventListener('click', () => {
                    student.score += 1;
                    updateRanking();
                });
                
                const minusBtn = document.createElement('button');
                minusBtn.className = 'score-btn';
                minusBtn.textContent = '-';
                minusBtn.addEventListener('click', () => {
                    if (student.score > 0) {
                        student.score -= 1;
                        updateRanking();
                    }
                });
                
                scoreControls.appendChild(minusBtn);
                scoreControls.appendChild(scoreDisplay);
                scoreControls.appendChild(addBtn);
                
                rankItem.appendChild(studentInfo);
                rankItem.appendChild(scoreControls);
                
                rankingList.appendChild(rankItem);
            });
        }
        
        // 初始化
        updateRanking();
    </script>


<a href="https://lowenzhou.github.io/2517/2517.html">2517官網：https://lowenzhou.github.io/2517/2517.html</a>
</body>
</html>
